# Amol Shah | z1723133 | CSCI 330 | Assignment 5 | 03/30/16
#!/bin/bash

#Creates new database
if [ $2 == 'new' ]; then
		 
#Checks if database exists
	if [ ! -e "$1" ]; then

#Uses argument as databases header line
		if [ $# -eq 3 ]; then 
			echo $3 > $1
			echo New database created

#Uses default header if one is not provided
		elif [ $# -eq 2 ]; then
			echo Automobile Database > $1
			echo New database created with default header

#Displays error if incorrect arguments
		else
			echo Incorrect arguments, if using multiple words enclose them in quotes
			exit -1
		fi

#Displays error if database already exists
	else
		echo Database already exists
		exit -1
	fi

#Adds a single record to database
elif [ $2 == 'add' ]; then

#Checks for existence, readability, and writability of database file
	if [[ -e "$1" && -r "$1" && -w "$1" ]]; then
		if [ $# -eq 6 ]; then

#Checks for valid year range 
			if [[ $5 -gt 1870 && $5 -lt 2020 ]]; then
				echo $3, $4, $5, $6 >> $1 
				echo Successfully added a record to the database.

#Displays error if year range argument is out of range			
			else
				echo Valid model years are from 1871 to 2019
				echo You entered $5 
				exit -1
			fi

#Displays error if the number of arguments are incorrect
		else
			echo Incorrect number of arguments. Usage: add make model year color
		fi

#Displays error if database file does not exist, is unreadable, or unwritable
	else
		echo Database does not exist or can not be read or written to.
	fi

#Shows a single, all, or range of records from database 
elif [ $2 == 'show' ]; then
	if [ -e $1 ]
		LINES=$(wc -l < $1) 

#Checks if database is empty
	if [ $LINES -le 1 ]; then
		echo Database is empty	
		exit -1
	fi

#Shows all records in database
	if [[ $# -eq 3 && $3 == 'all' ]]; then
		cat $1

#Shows a single record from database
	elif [[ $# -eq 4 && $3 == 'single' ]]; then
		re='^[0-9]+$'
		if [[ $4 =~ $re && $4 -lt $LINES && $4 -ge 1 ]]; then
			cat $1 | sed -n 1p
			sed -n $(($4+1))p < $1 
		else
			echo Argument 4 should be a digit and less than number of records and greater than one
		fi

#Shows a range of records from database
	elif [[ $# -eq 5 && $4 -lt $5 && $5 -lt $LINES ]]; then
		cat $1 | sed -n 1p
		sed -n $(($4+1)),$(($5+1))p < $1

#Displays error if incorrect number of arguments
	else
		echo Incorrect usage, records in specified lines do not exist. Check range arguments.	 
	fi

#Deletes a single, all, or range of records from database
elif [ $2 == 'delete' ]; then
	if [[ -e $1 && -r $1 && -w $1 ]]
		LINES=$(wc -l < $1) 
	fi
#Deletes all records except header in database
		if [[ $# -eq 3 && $3 == 'all' ]]; then 
			cat $1 | sed -n 1p > temp
			mv temp $1
			echo Deleted all lines except header 

#Deletes single record from database
		elif [[ $# -eq 4 && $4 -gt 1 && $4 -lt $LINES ]]; then
		cat $1 | sed -e "$(($4+1))"'d' > temp
		mv temp $1
		echo 1 record deleted
		
#Displays error if incorrect number of arguments
		else
			echo Incorrect usage, can only delete existing records 
		fi
else 
 	echo END******************************** 
fi
